<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qual é o país?</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="shortcut icon" href="assets/favicon.svg" type="image/x-icon">
</head>

<body class="bg-dark text-light">

    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6 col-10 d-grid text-center">
                <h1>Qual o nome do país?</h1>

                <!-- Imagem da bandeira do país -->
                <div class="justify-content-center">
                    <img class="rounded mt-5" id="bandeira" src="" height="125px" alt="bandeira">
                </div>

                <!-- Conjuto de dicas -->
                <ul class="list-group mt-5" id="dicas"></ul>

                <!-- Formulário -->
                <form class="d-grid mt-5 mb-4" action="" novalidate>
                    <input class="form-control" id="txt_pais" type="text" placeholder="Nome do país">
                    <br>
                    <button class="btn btn-primary" id="btn_resposta"><strong>Responder</strong></button>
                </form>

                <!-- Botão para obter dica -->
                <button class="btn btn-outline-success" id="btn_dica"><strong>Dica</strong></button><br>

                <!-- Botão para passar para o próximo texto -->
                <button class="btn btn-outline-secondary mb-5" id="btn_proximo"><strong>Próximo</strong></button>

                <!-- Texto de sucesso ou erro -->
                <div class="alert d-none" role="alert" id="mensagem"></div>

                <!-- Footer -->
                <div class="fixed-bottom footer p-3 text-center">
                    Qual o país? &copy; 2024 Todos os direitos reservados.
                </div>
            </div>
        </div>
    </div>

    <!-- JS do Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
        </script>

    <script>

        let pais;
        let regiao;
        let capital;
        let contador_dicas = 0;

        // Carrega pela primeira vez os dados
        buscarDados();

        // Busca os dados da API RestCountries
        function buscarDados() {
            // Carrega os países e escolhe um aleatóriamente
            fetch("https://restcountries.com/v3.1/all")
                .then(dados => dados.json())
                .then(json => {
                    let paises = json;
                    let index_pais = Math.floor(Math.random() * paises.length);
                    // Colocando a bandeira
                    document.querySelector('#bandeira').setAttribute('src', paises[index_pais].flags.png);
                    // Obtendo o nome
                    pais = paises[index_pais].translations.por.common;
                    // Obtendo região
                    regiao = paises[index_pais].region;
                    // Obtendo capital
                    capital = paises[index_pais].capital[0];
                })
                .catch(err => console.log("Ocorreu um erro."));
        }

        // Verifica se a resposta está correta e exibir retorno
        document.querySelector('#btn_resposta').addEventListener('click', () => {
            event.preventDefault();
            let input_pais = document.querySelector('#txt_pais');
            let txt_pais = input_pais.value;
            let mensagem = document.querySelector('#mensagem');
            mensagem.classList.remove('alert-danger');
            mensagem.classList.remove('alert-success');
            if (txt_pais.trim() == '') {
                mensagem.classList.add('alert-warning');
                mensagem.classList.remove('d-none');
                mensagem.innerHTML = `Insira o nome do país.`;
            } else if (txt_pais.toUpperCase() != pais.toUpperCase()) {
                input_pais.setAttribute('disabled', '');
                mensagem.classList.add('alert-danger');
                mensagem.classList.remove('d-none');
                mensagem.innerHTML = `Errado. O país correto é <b>${pais}</b>.`;
            } else {
                input_pais.setAttribute('disabled', '');
                mensagem.classList.add('alert-success');
                mensagem.classList.remove('d-none');
                mensagem.innerHTML = "Correto.";
            }
        });

        // Passa para o próximo país
        document.querySelector('#btn_proximo').addEventListener('click', () => {
            buscarDados();
            document.querySelector('#mensagem').classList.add('d-none');
            document.querySelector('#txt_pais').value = '';
            document.querySelector('#dicas').innerHTML = '';
            document.querySelector('#txt_pais').removeAttribute('disabled');
            contador_dicas = 0;
        });

        // Obter dicas:
        // 1 - Em qual continente está localizado o país
        // 2 - Qual a capital do país
        document.querySelector('#btn_dica').addEventListener('click', () => {
            if (contador_dicas < 2) {
                contador_dicas += 1;
                let dicas = document.querySelector('#dicas');
                let li;
                li = document.createElement('li');
                li.classList.add('list-group-item', 'bg-dark', 'text-light');
                switch (contador_dicas) {
                    case 1:
                        li.innerHTML = `A região deste país é <b>${regiao}</b>`;
                        break;
                    case 2:
                        li.innerHTML = `A capital deste país é <b>${capital}</b>`;
                        break;
                }
                dicas.appendChild(li);
            } else {
                alert("Número máximo de dicas atingido.");
            }
        })

    </script>

</body>

</html>